<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyfd.dao.mp.BillPkgDao">
	<sql id="Base_Column_List">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, name, value, price, carrier_type, update_date, update_user,
		create_date, create_user
	</sql>

	<select id="getBillPkgCount" resultType="java.lang.Integer">
		select count(0) from mp_bill_pkg
			<include refid="myWhere" />
		ORDER BY create_date desc
	</select>

	<select id="selectByPrimaryKey" parameterType="java.lang.String"
		resultType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from mp_bill_pkg
		where id = #{id,jdbcType=VARCHAR}
	</select>
	<select id="selectIdByValue" parameterType="java.lang.Double"
		resultType="java.lang.String">
		select
			id
		from mp_bill_pkg
		where value = #{value}
	</select>
	<select id="selectAll" resultType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
			<include refid="Base_Column_List" />
		from mp_bill_pkg
			<include refid="myWhere" />
		ORDER BY value
	</select>
	<select id="selectPkgs" resultType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
			<include refid="Base_Column_List" />
		from mp_bill_pkg
		where 1 = 1
			<if test = "value != null and value != ''">
				and value = #{value,jdbcType=DECIMAL}
			</if>
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from mp_bill_pkg
		where id = #{id,jdbcType=VARCHAR}
	</delete>
	<update id="batchDeleteByPrimaryKey">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update mp_bill_pkg set del_flag = 0
		where id in
		<foreach item="item" index="index" collection="array" open="(" separator="," close=")">  
		 	#{item} 
		</foreach> 
	</update>
	<insert id="insert" parameterType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<selectKey keyProperty="myuuid" resultType="String" order="BEFORE">select  replace(uuid(),'-','') as myuuid  from dual</selectKey>
		insert into mp_bill_pkg (id, name, value,
		price, carrier_type, update_date,
		update_user, create_date, create_user
		)
		values (#{myuuid,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR},
		#{value,jdbcType=DECIMAL},
		#{value,jdbcType=DECIMAL}, #{carrierType,jdbcType=VARCHAR},
		#{updateDate,jdbcType=TIMESTAMP},#{updateUser,jdbcType=VARCHAR}, 
		CURRENT_TIMESTAMP,#{createUser,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into mp_bill_pkg
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="value != null">
				value,
			</if>
			<if test="value != null">
				price,
			</if>
			<if test="carrierType != null">
				carrier_type,
			</if>
			<if test="updateDate != null">
				update_date,
			</if>
			<if test="updateUser != null">
				update_user,
			</if>
			<if test="createDate != null">
				create_date,
			</if>
			<if test="createUser != null">
				create_user,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="value != null">
				#{value,jdbcType=DECIMAL},
			</if>
			<if test="value != null">
				#{value,jdbcType=DECIMAL},
			</if>
			<if test="carrierType != null">
				#{carrierType,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				#{updateDate,jdbcType=TIMESTAMP},
			</if>
			<if test="updateUser != null">
				#{updateUser,jdbcType=VARCHAR},
			</if>
			<if test="createDate != null">
				#{createDate,jdbcType=TIMESTAMP},
			</if>
			<if test="createUser != null">
				#{createUser,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="java.util.Map">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update mp_bill_pkg
		<set>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="value != null">
				value = #{value,jdbcType=DECIMAL},
				price = #{value,jdbcType=DECIMAL},
			</if>
			<if test="carrierType != null">
				carrier_type = #{carrierType,jdbcType=VARCHAR},
			</if>
			<if test="updateDate != null">
				update_date = CURRENT_TIMESTAMP,
			</if>
			<if test="updateUser != null">
				update_user = #{updateUser,jdbcType=VARCHAR},
			</if>
			<if test="createDate != null">
				create_date = #{createDate,jdbcType=TIMESTAMP},
			</if>
			<if test="createUser != null">
				create_user = #{createUser,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	
	<select id="getBillPkgByPrice" resultType="java.lang.String">
		select id from mp_bill_pkg where value = #{value}
	</select>
	<sql id="myWhere">
    <where>
    	del_flag = 1
		<if test="billPkgName !=null ">
			and name like concat('%',#{billPkgName,jdbcType=VARCHAR},'%') 
		</if>
    </where>
    </sql>
    
    <select id="getBillPkgByProIdAndPrice" resultType="java.util.Map">
	SELECT * FROM mp_bill_pkg  WHERE del_flag = 1 
	and id in (SELECT bill_pkg_id from mp_provider_bill_pkg 
		where provider_id = #{providerId,jdbcType=VARCHAR} and province_code = #{provinceCode,jdbcType=VARCHAR})
	 and value = #{value,jdbcType=VARCHAR}
	</select>
    
    <!-- 获取代理商可用话费包 -->
	<select id="selectBillPkgForAgent" resultType="java.util.Map">
		select * from mp_bill_pkg 
		where value = #{price,jdbcType=VARCHAR} 
		and id in (SELECT bill_pkg_id from mp_agent_bill_discount 
		where agent_id = #{agentId,jdbcType=VARCHAR} and provider_id = #{providerId,jdbcType=VARCHAR} and province_code in('全国', #{provinceCode,jdbcType=VARCHAR})) 
	</select>
	<!-- 获取代理商可用话费包 -->
	<select id="selectBillPkgForAgentRYC" resultType="java.util.Map">
		select * from mp_bill_pkg 
		where name = '任意充' 
		and id in (SELECT bill_pkg_id from mp_agent_bill_discount 
		where agent_id = #{agentId,jdbcType=VARCHAR} and provider_id = #{providerId,jdbcType=VARCHAR} and province_code in('全国', #{provinceCode,jdbcType=VARCHAR})) 
	</select>
</mapper>