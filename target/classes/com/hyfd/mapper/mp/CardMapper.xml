<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyfd.dao.mp.CardDao">
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, card_id as cardId, card_pass as cardPass, date_format(expire_time, '%Y-%m-%d %H:%i:%s') as expireTime,date_format(use_time, '%Y-%m-%d %H:%i:%s') as useTime, 
    use_state as useState, price, fail_count as failCount, order_id as orderId, 
    result_msg as resultMsg, type, remark
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_card
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectByOrderId" parameterType="java.lang.String" resultType="java.util.Map">
    select 
    <include refid="Base_Column_List" />
    from mp_card
    where order_id = #{orderId,jdbcType=VARCHAR}
  </select>
  <select id="countCard" resultType="java.lang.Integer">
    select 
    	count(1)
    from mp_card where 1 = 1 
    <if test="cardId != null and cardId != ''">
       and card_id = #{cardId,jdbcType=VARCHAR}
    </if>
    <if test="cardPass != null and cardPass != ''">
       and card_pass = #{cardPass,jdbcType=VARCHAR}
    </if>
    <if test="expireTime != null and expireTime != ''">
       and expire_time = #{expireTime,jdbcType=DATE}
    </if>
    <if test="useTime != null and useTime != ''">
       and use_time = #{useTime,jdbcType=TIMESTAMP}
    </if>
    <if test="startDate != null and startDate != ''">
       and use_time &gt;= #{startDate,jdbcType=VARCHAR}
    </if>
    <if test="endDate != null and endDate != ''">
       and use_time &lt; #{endDate,jdbcType=TIMESTAMP}
    </if>
    <if test="useState != null and useState != ''">
       and use_state = #{useState,jdbcType=INTEGER}
    </if>
    <if test="price != null and price != ''">
       and price = #{price,jdbcType=INTEGER}
    </if>
    <if test="failCount != null and failCount != ''">
       and fail_count = #{failCount,jdbcType=INTEGER}
    </if>
    <if test="orderId != null and orderId != ''">
       and order_id = #{orderId,jdbcType=VARCHAR}
    </if>
    <if test="resultMsg != null and resultMsg != ''">
       and result_msg = #{resultMsg,jdbcType=VARCHAR}
    </if>
    <if test="type != null and type != ''">
       and type = #{type,jdbcType=VARCHAR}
    </if>
    <if test="remark != null and remark != ''">
       and remark = #{remark,jdbcType=VARCHAR}
    </if>
  </select>
  <select id="selectAll" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_card where 1 = 1 
    <if test="cardId != null and cardId != ''">
       and card_id = #{cardId,jdbcType=VARCHAR}
    </if>
    <if test="cardPass != null and cardPass != ''">
       and card_pass = #{cardPass,jdbcType=VARCHAR}
    </if>
    <if test="expireTime != null and expireTime != ''">
       and expire_time = #{expireTime,jdbcType=DATE}
    </if>
    <if test="useTime != null and useTime != ''">
       and use_time = #{useTime,jdbcType=TIMESTAMP}
    </if>
    <if test="startDate != null and startDate != ''">
       and use_time &gt;= #{startDate,jdbcType=VARCHAR}
    </if>
    <if test="endDate != null and endDate != ''">
       and use_time &lt; #{endDate,jdbcType=TIMESTAMP}
    </if>
    <if test="useState != null and useState != ''">
       and use_state = #{useState,jdbcType=INTEGER}
    </if>
    <if test="price != null and price != ''">
       and price = #{price,jdbcType=INTEGER}
    </if>
    <if test="failCount != null and failCount != ''">
       and fail_count = #{failCount,jdbcType=INTEGER}
    </if>
    <if test="orderId != null and orderId != ''">
       and order_id = #{orderId,jdbcType=VARCHAR}
    </if>
    <if test="resultMsg != null and resultMsg != ''">
       and result_msg = #{resultMsg,jdbcType=VARCHAR}
    </if>
    <if test="type != null and type != ''">
       and type = #{type,jdbcType=VARCHAR}
    </if>
    <if test="remark != null and remark != ''">
       and remark = #{remark,jdbcType=VARCHAR}
    </if>
    order by use_time desc
  </select>
  <select id="selectOneCard" resultType="java.util.Map">
    select 
    <include refid="Base_Column_List" />
    from mp_card where use_state = 0 
    	and expire_time &gt;= curdate()
    <if test="price != null">
       and price = #{price,jdbcType=INTEGER}
    </if>
    <if test="type != null">
       and type = #{type,jdbcType=VARCHAR}
    </if>
    order by card_pass
    limit 0,1
  </select>
	<!--   更新卡密状态	 -->
  <update id="updateState" parameterType="java.util.Map">
  	update mp_card set use_time = now(),
  	<if test="useState != null and useState != ''">
  		use_state = #{useState,jdbcType=INTEGER}
  	</if>
  	where 1 = 1 
  	<if test="cardPass != null and cardPass != ''">
  		and card_pass = #{cardPass,jdbcType=VARCHAR}
  	</if>
  </update>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from mp_card
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_card (id, card_id, card_pass, 
      expire_time, use_time, use_state, 
      price, fail_count, order_id, 
      result_msg, type, remark
      )
    values (#{id,jdbcType=VARCHAR}, #{cardId,jdbcType=VARCHAR}, #{cardPass,jdbcType=VARCHAR}, 
      #{expireTime,jdbcType=DATE}, #{useTime,jdbcType=TIMESTAMP}, #{useState,jdbcType=INTEGER}, 
      #{price,jdbcType=INTEGER}, #{failCount,jdbcType=INTEGER}, #{orderId,jdbcType=VARCHAR}, 
      #{resultMsg,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_card
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="cardId != null">
        card_id,
      </if>
      <if test="cardPass != null">
        card_pass,
      </if>
      <if test="expireTime != null">
        expire_time,
      </if>
      <if test="useTime != null">
        use_time,
      </if>
      <if test="useState != null">
        use_state,
      </if>
      <if test="price != null">
        price,
      </if>
      <if test="failCount != null">
        fail_count,
      </if>
      <if test="orderId != null">
        order_id,
      </if>
      <if test="resultMsg != null">
        result_msg,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="remark != null">
        remark,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="cardId != null">
        #{cardId,jdbcType=VARCHAR},
      </if>
      <if test="cardPass != null">
        #{cardPass,jdbcType=VARCHAR},
      </if>
      <if test="expireTime != null">
        #{expireTime,jdbcType=DATE},
      </if>
      <if test="useTime != null">
        #{useTime,jdbcType=TIMESTAMP},
      </if>
      <if test="useState != null">
        #{useState,jdbcType=INTEGER},
      </if>
      <if test="price != null">
        #{price,jdbcType=INTEGER},
      </if>
      <if test="failCount != null">
        #{failCount,jdbcType=INTEGER},
      </if>
      <if test="orderId != null">
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="resultMsg != null">
        #{resultMsg,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_card
    <set>
      <if test="cardId != null">
        card_id = #{cardId,jdbcType=VARCHAR},
      </if>
      <if test="cardPass != null">
        card_pass = #{cardPass,jdbcType=VARCHAR},
      </if>
      <if test="expireTime != null">
        expire_time = #{expireTime,jdbcType=DATE},
      </if>
      <if test="useTime != null">
        use_time = #{useTime,jdbcType=TIMESTAMP},
      </if>
      <if test="useState != null">
        use_state = #{useState,jdbcType=INTEGER},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=INTEGER},
      </if>
      <if test="failCount != null">
        fail_count = #{failCount,jdbcType=INTEGER},
      </if>
      <if test="orderId != null">
        order_id = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="resultMsg != null">
        result_msg = #{resultMsg,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateCard" parameterType="java.util.Map">
    update mp_card
    <set>
      <if test="cardId != null">
        card_id = #{cardId,jdbcType=VARCHAR},
      </if>
      <if test="expireTime != null">
        expire_time = #{expireTime,jdbcType=DATE},
      </if>
      <if test="useTime != null">
        use_time = #{useTime,jdbcType=TIMESTAMP},
      </if>
      <if test="useState != null">
        use_state = #{useState,jdbcType=INTEGER},
      </if>
      <if test="price != null">
        price = #{price,jdbcType=INTEGER},
      </if>
      <if test="failCount != null">
        fail_count = #{failCount,jdbcType=INTEGER},
      </if>
      <if test="orderId != null">
        order_id = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="resultMsg != null">
        result_msg = #{resultMsg,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
    </set>
    where card_pass = #{cardPass,jdbcType=VARCHAR}
  </update>
  <select id="queryByCardId" parameterType="java.lang.String" resultType="java.util.Map">
  	select
  	<include refid="Base_Column_List" />
  	from mp_card where card_id = #{cardId,jdbcType=VARCHAR}
  </select>
</mapper>