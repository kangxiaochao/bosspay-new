<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyfd.dao.mp.ProviderPhysicalChannelDao">
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, name, link_url, callback_url, queue_name, provider_mark, provider_task_mark, channel_type,
    operator, parameter_list, default_parameter, priority, update_date, update_user, 
    create_date, create_user
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_provider_physical_channel
    where del_flag=1 and id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="getProviderIdByName" resultType="java.lang.String">
  select id from mp_provider_physical_channel WHERE del_flag=1 and `name`=#{name,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_provider_physical_channel where del_flag=1
    <if test="name != null">
       and name = #{name,jdbcType=VARCHAR}
    </if>
    <if test="linkUrl != null">
       and link_url = #{linkUrl,jdbcType=VARCHAR}
    </if>
    <if test="callbackUrl != null">
       and callback_url = #{callbackUrl,jdbcType=VARCHAR}
    </if>
    <if test="queueName != null">
       and queue_name = #{queueName,jdbcType=VARCHAR}
    </if>
    <if test="providerMark != null">
       and provider_mark = #{providerMark,jdbcType=VARCHAR}
    </if>
    <if test="providerTaskMark != null">
       and provider_task_mark = #{providerTaskMark,jdbcType=VARCHAR}
    </if>
    <if test="channelType != null">
       and channel_type = #{channelType,jdbcType=CHAR}
    </if>
    <if test="operator != null">
       and operator = #{operator,jdbcType=VARCHAR}
    </if>
    <if test="parameterList != null">
       and parameter_list = #{parameterList,jdbcType=VARCHAR}
    </if>
    <if test="defaultParameter != null">
       and default_parameter = #{defaultParameter,jdbcType=VARCHAR}
    </if>
    <if test="priority != null">
       and priority = #{priority,jdbcType=DECIMAL}
    </if>
    <if test="updateDate != null">
       and update_date = #{updateDate,jdbcType=TIMESTAMP}
    </if>
    <if test="updateUser != null">
       and update_user = #{updateUser,jdbcType=VARCHAR}
    </if>
    <if test="createDate != null">
       and create_date = #{createDate,jdbcType=TIMESTAMP}
    </if>
    <if test="createUser != null">
       and create_user = #{createUser,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select id="getPhysicalList" resultType="java.util.Map">

  	select * from mp_provider_physical_channel

  </select>
  
  <update id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_provider_physical_channel set del_flag=0
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <insert id="insert" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_provider_physical_channel (id, name, 
      link_url, callback_url, queue_name, 
      provider_mark, provider_task_mark, channel_type, operator,
      parameter_list, default_parameter, priority, 
      update_date, update_user, create_date, 
      create_user)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{linkUrl,jdbcType=VARCHAR}, #{callbackUrl,jdbcType=VARCHAR}, #{queueName,jdbcType=VARCHAR}, 
      #{providerMark,jdbcType=VARCHAR},#{providerTaskMark,jdbcType=VARCHAR}, #{channelType,jdbcType=CHAR},
      #{operator,jdbcType=VARCHAR}, #{parameterList,jdbcType=VARCHAR}, #{defaultParameter,jdbcType=VARCHAR},
      #{priority,jdbcType=DECIMAL}, #{updateDate,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=VARCHAR},
      #{createDate,jdbcType=TIMESTAMP}, #{createUser,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_provider_physical_channel
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="linkUrl != null">
        link_url,
      </if>
      <if test="callbackUrl != null">
        callback_url,
      </if>
      <if test="queueName != null">
        queue_name,
      </if>
      <if test="providerMark != null">
        provider_mark,
      </if>
      <if test="providerTaskMark != null">
        provider_task_mark,
      </if>
      <if test="channelType != null">
        channel_type,
      </if>
      <if test="operator != null">
        operator,
      </if>
      <if test="parameterList != null">
        parameter_list,
      </if>
      <if test="defaultParameter != null">
        default_parameter,
      </if>
      <if test="priority != null">
        priority,
      </if>
      <if test="updateDate != null">
        update_date,
      </if>
      <if test="updateUser != null">
        update_user,
      </if>
      <if test="createDate != null">
        create_date,
      </if>
      <if test="createUser != null">
        create_user,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="linkUrl != null">
        #{linkUrl,jdbcType=VARCHAR},
      </if>
      <if test="callbackUrl != null">
        #{callbackUrl,jdbcType=VARCHAR},
      </if>
      <if test="queueName != null">
        #{queueName,jdbcType=VARCHAR},
      </if>
      <if test="providerMark != null">
        #{providerMark,jdbcType=VARCHAR},
      </if>
      <if test="providerTaskMark != null">
        #{providerTaskMark,jdbcType=VARCHAR},
      </if>
      <if test="channelType != null">
        #{channelType,jdbcType=CHAR},
      </if>
      <if test="operator != null">
        #{operator,jdbcType=VARCHAR},
      </if>
      <if test="parameterList != null">
        #{parameterList,jdbcType=VARCHAR},
      </if>
      <if test="defaultParameter != null">
        #{defaultParameter,jdbcType=VARCHAR},
      </if>
      <if test="priority != null">
        #{priority,jdbcType=DECIMAL},
      </if>
      <if test="updateDate != null">
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        #{createUser,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_provider_physical_channel
    <set>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="linkUrl != null">
        link_url = #{linkUrl,jdbcType=VARCHAR},
      </if>
      <if test="callbackUrl != null">
        callback_url = #{callbackUrl,jdbcType=VARCHAR},
      </if>
      <if test="queueName != null">
        queue_name = #{queueName,jdbcType=VARCHAR},
      </if>
      <if test="providerMark != null">
        provider_mark = #{providerMark,jdbcType=VARCHAR},
      </if>
      <if test="providerTaskMark != null">
        provider_task_mark = #{providerMark,jdbcType=VARCHAR},
      </if>
      <if test="channelType != null">
        channel_type = #{channelType,jdbcType=CHAR},
      </if>
      <if test="operator != null">
        operator = #{operator,jdbcType=VARCHAR},
      </if>
      <if test="parameterList != null">
        parameter_list = #{parameterList,jdbcType=VARCHAR},
      </if>
      <if test="defaultParameter != null">
        default_parameter = #{defaultParameter,jdbcType=VARCHAR},
      </if>
      <if test="priority != null">
        priority = #{priority,jdbcType=DECIMAL},
      </if>
      <if test="updateDate != null">
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null">
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null">
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectByProviderId" parameterType="java.lang.String" resultType="java.util.Map">
    select 
    <include refid="Base_Column_List" />
    from mp_provider_physical_channel
    where id = #{providerId,jdbcType=VARCHAR}
  </select>
  
	<select id="getProviderPhysicalChannelCount" resultType="java.lang.Integer">
		select count(0) from mp_provider_physical_channel a  
		where a.del_flag=1
		<if test="name !=null ">
		and a.name like concat('%',#{name,jdbcType=VARCHAR},'%') 
		</if>
		<if test="channel_type !=null &amp;&amp; channel_type !=''">
		and a.channel_type =#{channel_type,jdbcType=VARCHAR}
		</if>
	</select>
	<select id="getProviderPhysicalChannelList" resultType="java.util.Map">
		SELECT
			a.id AS id,
			a.`name` AS NAME,
			GROUP_CONCAT(d.`name`) stProvider,
			a.channel_type AS channel_type,
			b.balance AS balance
		FROM
			mp_provider_physical_channel a
		LEFT JOIN mp_provider_account b ON a.id = b.provider_id
		LEFT JOIN (SELECT DISTINCT provider_id ,provider_physical_channel_id from mp_provider_bill_dispatcher where del_flag = 0) c ON a.id = c.provider_physical_channel_id
		LEFT JOIN mp_provider d ON c.provider_id = d.id
		WHERE
			a.del_flag = 1
		<if test="name !=null ">
		and a.name like concat('%',#{name,jdbcType=VARCHAR},'%') 
		</if>
		<if test="channel_type !=null &amp;&amp; channel_type !=''">
		and a.channel_type =#{channel_type,jdbcType=VARCHAR}
		</if>
		GROUP BY NAME
		 ORDER BY a.create_date desc
	</select>
	<select id="getProviderPhysicalChannelById" resultType="java.util.Map">
		select a.id as id,a.`name` as `name`,a.provider_id,a.link_url as link_url,a.callback_url as callback_url,
		a.queue_name as queue_name,a.provider_mark as provider_mark,a.provider_task_mark as provider_task_mark,a.channel_type as channel_type,a.operator as operator,
		a.parameter_list as parameter_list,a.default_parameter as default_parameter,a.priority as priority,a.create_date as create_date,
		a.update_date as update_date,b.`name` as providerName
		from mp_provider_physical_channel a left join mp_provider b on a.provider_id = b.id
		where a.id=#{id}
	</select>
	
	<select id="getProviderList" resultType="java.util.Map">
		<if test="providerPhysicalChannelId !=null &amp;&amp; providerPhysicalChannelId !=''">
			select a.* from mp_provider a,mp_provider_physical_channel b where b.id = #{providerPhysicalChannelId,jdbcType=VARCHAR} and a.id = b.provider_id
			union
		</if>
		select a.* from mp_provider a where not exists(select distinct b.provider_id from mp_provider_physical_channel b where b.provider_id = a.id)
	</select>
	
	<insert id="providerPhysicalChannelAdd" >
	<selectKey keyProperty="myuuid" resultType="String" order="BEFORE">
		select case when max(id) is null then '2000000001' else max(id)+1 end as myuuid from mp_provider_physical_channel
	</selectKey>
	  insert into mp_provider_physical_channel(id,name,link_url,
	  callback_url,queue_name,provider_mark,provider_task_mark
	  channel_type,operator, parameter_list,default_parameter,
	  priority,create_user,create_date) 
	  VALUES(#{myuuid,jdbcType=VARCHAR},#{name,jdbcType=VARCHAR},#{link_url,jdbcType=VARCHAR},
	  #{callback_url,jdbcType=VARCHAR},#{queue_name,jdbcType=VARCHAR},#{provider_mark,jdbcType=VARCHAR}, #{provider_task_mark,jdbcType=VARCHAR},
	  #{channel_type,jdbcType=VARCHAR},#{operator,jdbcType=VARCHAR}, #{parameter_list,jdbcType=VARCHAR}, #{default_parameter,jdbcType=VARCHAR},
	  #{priority,jdbcType=VARCHAR},
	  #{create_user,jdbcType=VARCHAR},CURRENT_TIMESTAMP)
	</insert>
	
	<update id="providerPhysicalChannelEdit">
	  update mp_provider_physical_channel set provider_id=#{provider_id,jdbcType=VARCHAR},name=#{name,jdbcType=VARCHAR},
	  link_url=#{link_url,jdbcType=VARCHAR},callback_url=#{callback_url,jdbcType=VARCHAR},queue_name=#{queue_name,jdbcType=VARCHAR},
	  provider_mark=#{provider_mark,jdbcType=VARCHAR},provider_task_mark=#{provider_task_mark,jdbcType=VARCHAR},channel_type=#{channel_type,jdbcType=VARCHAR},
	  operator=#{operator,jdbcType=VARCHAR},parameter_list=#{parameter_list,jdbcType=VARCHAR},default_parameter=#{default_parameter,jdbcType=VARCHAR},
	  priority=#{priority,jdbcType=VARCHAR},update_user=#{update_user,jdbcType=VARCHAR},update_date=CURRENT_TIMESTAMP where id=#{id,jdbcType=VARCHAR}
	</update>
	
    <update id="providerPhysicalChannelDel">
      update mp_provider_physical_channel set del_flag=0 where id=#{id,jdbcType=VARCHAR}
    </update>
    
    <sql id="myWhere">
    <where>
		<if test="name !=null ">
		and a.name like concat('%',#{name,jdbcType=VARCHAR},'%')
		</if>
		<if test="channel_type !=null &amp;&amp; channel_type !=''">
		and a.channel_type =#{channel_type,jdbcType=VARCHAR}
		</if>
    </where>
    </sql>
</mapper>