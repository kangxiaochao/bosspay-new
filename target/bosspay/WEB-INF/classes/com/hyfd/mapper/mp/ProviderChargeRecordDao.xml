<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyfd.dao.mp.ProviderChargeRecordDao">
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, provider_id, order_id, fee, balance_before, balance_after, apply_date, end_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_provider_charge_record
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from mp_provider_charge_record where del_flag = 1 
    <if test="providerId != null">
       and provider_id = #{providerId,jdbcType=VARCHAR}
    </if>
    <if test="orderId != null">
       and order_id = #{orderId,jdbcType=VARCHAR}
    </if>
    <if test="fee != null">
       and fee = #{fee,jdbcType=DECIMAL}
    </if>
    <if test="balanceBefore != null">
       and balance_before = #{balanceBefore,jdbcType=DECIMAL}
    </if>
    <if test="balanceAfter != null">
       and balance_after = #{balanceAfter,jdbcType=DECIMAL}
    </if>
    <if test="applyDate != null">
       and apply_date = #{applyDate,jdbcType=TIMESTAMP}
    </if>
    <if test="endDate != null">
       and end_date = #{endDate,jdbcType=TIMESTAMP}
    </if>
    order by apply_date desc
  </select>
  <update id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_provider_charge_record set del_flag=0
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <insert id="insert" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_provider_charge_record (id, provider_id, order_id, 
      fee, balance_before, balance_after, 
      apply_date, end_date)
    values (#{id,jdbcType=VARCHAR}, #{providerId,jdbcType=VARCHAR}, #{orderId,jdbcType=VARCHAR}, 
      #{fee,jdbcType=DECIMAL}, #{balanceBefore,jdbcType=DECIMAL}, #{balanceAfter,jdbcType=DECIMAL}, 
      #{applyDate,jdbcType=TIMESTAMP}, #{endDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_provider_charge_record
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="providerId != null">
        provider_id,
      </if>
      <if test="orderId != null">
        order_id,
      </if>
      <if test="fee != null">
        fee,
      </if>
      <if test="balanceBefore != null">
        balance_before,
      </if>
      <if test="balanceAfter != null">
        balance_after,
      </if>
      <if test="applyDate != null">
        apply_date,
      </if>
      <if test="endDate != null">
        end_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="providerId != null">
        #{providerId,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null">
        #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="fee != null">
        #{fee,jdbcType=DECIMAL},
      </if>
      <if test="balanceBefore != null">
        #{balanceBefore,jdbcType=DECIMAL},
      </if>
      <if test="balanceAfter != null">
        #{balanceAfter,jdbcType=DECIMAL},
      </if>
      <if test="applyDate != null">
        #{applyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null">
        #{endDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_provider_charge_record
    <set>
      <if test="providerId != null">
        provider_id = #{providerId,jdbcType=VARCHAR},
      </if>
      <if test="orderId != null">
        order_id = #{orderId,jdbcType=VARCHAR},
      </if>
      <if test="fee != null">
        fee = #{fee,jdbcType=DECIMAL},
      </if>
      <if test="balanceBefore != null">
        balance_before = #{balanceBefore,jdbcType=DECIMAL},
      </if>
      <if test="balanceAfter != null">
        balance_after = #{balanceAfter,jdbcType=DECIMAL},
      </if>
      <if test="applyDate != null">
        apply_date = #{applyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null">
        end_date = #{endDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  	<select id="selectDispatcherProviderStatisticsInfo" resultType="java.util.Map">
  		select a.*,b.`name` from (
			select t.provider_id,sum(t.fee) cutmoney,t.balance_after balance from (
				select * from mp_provider_charge_record where order_id in (
					select id from mp_order where 
						apply_date &gt; #{startDate,jdbcType=VARCHAR}
						and apply_date &lt; #{endDate,jdbcType=VARCHAR}
						and dispatcher_provider_id=#{providerId,jdbcType=VARCHAR}
						and `status`='3'
				) order by apply_date desc
			) t
			group by t.provider_id
		) a
		left join
			mp_provider_physical_channel b
		on
			a.provider_id = b.id
  	</select>
</mapper>