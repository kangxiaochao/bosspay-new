<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyfd.dao.mp.AgentDao">
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    a.id, a.bill_group_id, a.data_group_id, a.bill_model_id, a.data_model_id, a.user_id, 
    a.`name`, a.nickname, a.phone, a.email, a.corp_name, a.address, a.hotline1, a.hotline2, 
    a.serviceqq1, a.serviceqq2, a.app_key, a.level, a.parent_id, a.status, 
    date_format(a.start_date,'%Y-%m-%d') as start_date, 
    date_format(a.end_date,'%Y-%m-%d') as end_date, a.update_date, a.update_user, 
    a.create_date, a.create_user,b.suName,c.balance,c.profit,c.credit,a.channel_person
  </sql>
  <select id="selectById" resultType="java.util.Map">
  	select * from mp_agent where id = #{id,jdbcType=VARCHAR} and del_flag = 1
  </select>
  <select id="selectAgentIdByUserid" resultType="java.lang.String">
  	select id from mp_agent where user_id = #{userId,jdbcType=VARCHAR} and del_flag = 1
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select t.*,t2.name as parentName,t3.suName channelPerson from
    (
	    select 
	  		y.*,d.`name` AS billGroupName,
	  		f.`name` AS billDiscountModelName
	  	from (	
		    select 
		    <include refid="Base_Column_List" />
		    from 
		    	mp_agent a,sysusert b,mp_agent_account c
		    where a.del_flag = 1
		    	and a.id = #{id,jdbcType=VARCHAR}
		    	and a.user_id = b.suId 
		    	and a.id = c.agent_id 
		) y left join mp_provider_bill_group d on y.bill_group_id = d.id
			left join mp_bill_discount_model f on y.bill_model_id = f.id
	) as t left join mp_agent t2
	on
		t.parent_id = t2.id
		left join sysusert t3
		on t3.suId = t.channel_person
      order by t.create_date desc
  </select>
  <select id="selectParentAgent" resultType="java.util.Map">
  		select 
	    *
	    from 
	    	mp_agent 
	    where del_flag = 1
  </select>
  <select id="selectAllSubAgent" resultType="java.util.Map">
        select
            *
        from
            mp_agent
        where
            parent_path LIKE concat('%',#{agentId,jdbcType=VARCHAR},'%')
        and id != #{agentId,jdbcType=VARCHAR}
        and del_flag = 1
  </select>
  <select id="selectAll" resultType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select t.*,t2.name as parentName, t3.suName channelPerson,t4.totalMoney from
    (
    	select 
	  		y.*,d.`name` AS billGroupName,
	  		f.`name` AS billDiscountModelName
	  	from (
		    select 
		    <include refid="Base_Column_List" />
		    from 
		    	mp_agent a,sysusert b,mp_agent_account c
		    where a.del_flag = 1 and
		    	a.user_id = b.suId 
		    	<!-- and a.del_flag = 1 -->
		    	and a.id = c.agent_id 
		    <if test="billGroupId != null and bizType !=''">
		       and a.bill_group_id = #{billGroupId,jdbcType=VARCHAR}
		    </if>
		    <if test="agentParentId != null and agentParentId != ''" >
		       and a.id in(select id from mp_agent where parent_id=#{agentParentId} and del_flag = 1)
		    </if>
		    <if test="dataGroupId != null and dataGroupId !=''">
		       and a.data_group_id = #{dataGroupId,jdbcType=VARCHAR}
		    </if>
		    <if test="billModelId != null and billModelId !=''">
		       and a.bill_model_id = #{billModelId,jdbcType=VARCHAR}
		    </if>
		    <if test="dataModelId != null and dataModelId !=''">
		       and a.data_model_id = #{dataModelId,jdbcType=VARCHAR}
		    </if>
		    <if test="userId != null and userId !=''">
		       and a.user_id = #{userId,jdbcType=VARCHAR}
		    </if>
		    <if test="name != null and name !=''">
		       and a.name like concat('%',#{name,jdbcType=VARCHAR},'%') 
		    </if>
		    <if test="nickname != null and nickname !=''">
		       and a.nickname = #{nickname,jdbcType=VARCHAR}
		    </if>
		    <if test="phone != null and phone !=''">
		       and a.phone = #{phone,jdbcType=VARCHAR}
		    </if>
		    <if test="email != null and email !=''">
		       and a.email = #{email,jdbcType=VARCHAR}
		    </if>
		    <if test="corpName != null and corpName != ''">
		       and a.corp_name = #{corpName,jdbcType=VARCHAR}
		    </if>
		    <if test="address != null and address !=''">
		       and a.address = #{address,jdbcType=VARCHAR}
		    </if>
		    <if test="hotline1 != null and hotline1 !=''">
		       and a.hotline1 = #{hotline1,jdbcType=VARCHAR}
		    </if>
		    <if test="hotline2 != null and hotline2 !=''">
		       and a.hotline2 = #{hotline2,jdbcType=VARCHAR}
		    </if>
		    <if test="serviceqq1 != null and serviceqq1 !=''">
		       and a.serviceqq1 = #{serviceqq1,jdbcType=VARCHAR}
		    </if>
		    <if test="serviceqq2 != null and serviceqq2 !=''">
		       and a.serviceqq2 = #{serviceqq2,jdbcType=VARCHAR}
		    </if>
		    <if test="appKey != null and appKey !=''">
		       and a.app_key = #{appKey,jdbcType=VARCHAR}
		    </if>
		    <if test="parentName != null and parentName != ''">
		       and a.parent_id in
		       (
		       		select id from mp_agent where 
		       		name like concat('%',#{parentName,jdbcType=VARCHAR},'%') 
		       		and del_flag = 1
		       )
		    </if>
		    <if test="status != null and status !=''">
		       and a.status = #{status,jdbcType=CHAR}
		    </if>
		    <if test="startDate != null and startDate != ''">
		       and a.start_date = #{startDate,jdbcType=TIMESTAMP}
		    </if>
		    <if test="endDate != null and endDate != ''">
		       and a.end_date = #{endDate,jdbcType=TIMESTAMP}
		    </if>
		    <if test="updateDate != null and updateDate != ''">
		       and a.update_date = #{updateDate,jdbcType=TIMESTAMP}
		    </if>
		    <if test="updateUser != null and updateUser !=''">
		       and a.update_user = #{updateUser,jdbcType=VARCHAR}
		    </if>
		    <if test="createDate != null and createDate != ''">
		       and a.create_date = #{createDate,jdbcType=TIMESTAMP}
		    </if>
		    <if test="createUser != null and createUser !=''">
		       and a.create_user = #{createUser,jdbcType=VARCHAR}
		    </if>
		) y left join mp_provider_bill_group d on y.bill_group_id = d.id
			left join mp_bill_discount_model f on y.bill_model_id = f.id
    ) as t
    left join mp_agent t2 on t.parent_id = t2.id
	left join sysusert t3 on t3.suId = t.channel_person
    left join (
          SELECT
              b.id,
              SUM(a.balance) totalMoney
          FROM
          (
              SELECT
                a1.id,
                a1.NAME,
                a1.parent_path,
                a2.balance
              FROM
                mp_agent a1
              LEFT JOIN mp_agent_account a2 ON a1.id = a2.agent_id
          ) a
          LEFT JOIN mp_agent b ON a.parent_path LIKE CONCAT('%', b.id, '%')
          GROUP BY b.id
    ) t4 on t.id = t4.id
  </select>
    <select id="selectZeroBalance" resultType="java.util.Map">
        SELECT
            t.*,
            t2.NAME AS parentName,
            t3.suName channelPerson,
            t4.totalMoney
        FROM
            (
                SELECT
                    y.*,
                    d.`name` AS billGroupName,
                    f.`name` AS billDiscountModelName
                FROM
                    (
                        SELECT
                            a.id,
                            a.bill_group_id,
                            a.data_group_id,
                            a.bill_model_id,
                            a.data_model_id,
                            a.user_id,
                            a.`name`,
                            a.nickname,
                            a.phone,
                            a.email,
                            a.corp_name,
                            a.address,
                            a.hotline1,
                            a.hotline2,
                            a.serviceqq1,
                            a.serviceqq2,
                            a.app_key,
                            a.LEVEL,
                            a.parent_id,
                            a.STATUS,
                            date_format( a.start_date, '%Y-%m-%d' ) AS start_date,
                            date_format( a.end_date, '%Y-%m-%d' ) AS end_date,
                            a.update_date,
                            a.update_user,
                            a.create_date,
                            a.create_user,
                            b.suName,
                            c.balance,
                            c.profit,
                            c.credit,
                            a.channel_person
                        FROM
                            mp_agent a,
                            sysusert b,
                            mp_agent_account c
                        WHERE
                            a.del_flag = 1
                          and a.`level` = '1'
                          AND a.user_id = b.suId
                          AND a.id = c.agent_id
                    ) y
                        LEFT JOIN mp_provider_bill_group d ON y.bill_group_id = d.id
                        LEFT JOIN mp_bill_discount_model f ON y.bill_model_id = f.id
            ) AS t
                LEFT JOIN mp_agent t2 ON t.parent_id = t2.id
                LEFT JOIN sysusert t3 ON t3.suId = t.channel_person
                LEFT JOIN (
                SELECT
                    b.id,
                    SUM( a.balance ) totalMoney
                FROM
                    (
                        SELECT
                            a1.id,
                            a1.NAME,
                            a1.parent_path,
                            a2.balance
                        FROM
                            mp_agent a1
                                LEFT JOIN mp_agent_account a2 ON a1.id = a2.agent_id
                    ) a
                        LEFT JOIN mp_agent b ON a.parent_path LIKE CONCAT( '%', b.id, '%' )
                GROUP BY
                    b.id
            ) t4 ON t.id = t4.id
    </select>
  <select id="selectCount" resultType="Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    count(1)
    from mp_agent where del_flag=1 <!-- del_flag = 1  -->
    <if test="billGroupId != null and billGroupId !=''">
       and bill_group_id = #{billGroupId,jdbcType=VARCHAR}
    </if>
    <if test="dataGroupId != null and dataGroupId !=''">
       and data_group_id = #{dataGroupId,jdbcType=VARCHAR}
    </if>
    <if test="billModelId != null and billModelId !=''">
       and bill_model_id = #{billModelId,jdbcType=VARCHAR}
    </if>
    <if test="agentParentId != null and agentParentId != ''" >
       and id in(select id from mp_agent where parent_id=#{agentParentId})
    </if>
    <if test="dataModelId != null and dataModelId !=''">
       and data_model_id = #{dataModelId,jdbcType=VARCHAR}
    </if>
    <if test="userId != null and userId !=''">
       and user_id = #{userId,jdbcType=VARCHAR}
    </if>
    <if test="name != null and name !=''">
       and name like concat('%',#{name,jdbcType=VARCHAR},'%') 
    </if>
    <if test="nickname != null and nickname !=''">
       and nickname = #{nickname,jdbcType=VARCHAR}
    </if>
    <if test="phone != null and phone !=''">
       and phone = #{phone,jdbcType=VARCHAR}
    </if>
    <if test="email != null and email !=''">
       and email = #{email,jdbcType=VARCHAR}
    </if>
    <if test="corpName != null and corpName != ''">
       and corp_name = #{corpName,jdbcType=VARCHAR}
    </if>
    <if test="address != null and address !=''">
       and address = #{address,jdbcType=VARCHAR}
    </if>
    <if test="hotline1 != null and hotline1 !=''">
       and hotline1 = #{hotline1,jdbcType=VARCHAR}
    </if>
    <if test="hotline2 != null and hotline2 !=''">
       and hotline2 = #{hotline2,jdbcType=VARCHAR}
    </if>
    <if test="serviceqq1 != null and serviceqq1 !=''">
       and serviceqq1 = #{serviceqq1,jdbcType=VARCHAR}
    </if>
    <if test="serviceqq2 != null and serviceqq2 !=''">
       and serviceqq2 = #{serviceqq2,jdbcType=VARCHAR}
    </if>
    <if test="appKey != null and appKey !=''">
       and app_key = #{appKey,jdbcType=VARCHAR}
    </if>
    <if test="parentName != null and parentName != ''">
       and parent_id in
       (
       		select id from mp_agent where 
       		name like concat('%',#{parentName,jdbcType=VARCHAR},'%') 
       		<!-- and del_flag = 1 -->
       )
    </if>
    <if test="status != null and status !=''">
       and status = #{status,jdbcType=CHAR}
    </if>
    <if test="startDate != null and startDate != ''">
       and start_date = #{startDate,jdbcType=TIMESTAMP}
    </if>
    <if test="endDate != null and endDate != ''">
       and end_date = #{endDate,jdbcType=TIMESTAMP}
    </if>
    <if test="updateDate != null and updateDate != ''">
       and update_date = #{updateDate,jdbcType=TIMESTAMP}
    </if>
    <if test="updateUser != null and updateUser !=''">
       and update_user = #{updateUser,jdbcType=VARCHAR}
    </if>
    <if test="createDate != null and createDate != ''">
       and create_date = #{createDate,jdbcType=TIMESTAMP}
    </if>
    <if test="createUser != null and createUser !=''">
       and create_user = #{createUser,jdbcType=VARCHAR}
    </if>
  </select>
  <update id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_agent set del_flag = 0 where id = #{id,jdbcType=VARCHAR} and del_flag = 1
  </update>
  <insert id="insert" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_agent (id, bill_group_id, data_group_id, 
      bill_model_id, data_model_id, user_id, 
      name, nickname, phone, 
      email, corp_name, address, 
      hotline1, hotline2, serviceqq1, 
      serviceqq2, app_key, parent_id, 
      status, level, start_date, end_date, 
      update_date, update_user, create_date, 
      create_user,channel_person,parent_path)
    values (#{id,jdbcType=VARCHAR}, #{billGroupId,jdbcType=VARCHAR}, #{dataGroupId,jdbcType=VARCHAR}, 
      #{billModelId,jdbcType=VARCHAR}, #{dataModelId,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR}, 
      #{name,jdbcType=VARCHAR}, #{nickname,jdbcType=VARCHAR}, #{phone,jdbcType=VARCHAR}, 
      #{email,jdbcType=VARCHAR}, #{corpName,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, 
      #{hotline1,jdbcType=VARCHAR}, #{hotline2,jdbcType=VARCHAR}, #{serviceqq1,jdbcType=VARCHAR}, 
      #{serviceqq2,jdbcType=VARCHAR}, #{appKey,jdbcType=VARCHAR}, #{parentId,jdbcType=VARCHAR}, 
      #{status,jdbcType=CHAR},#{level,jdbcType=INTEGER}, #{startDate,jdbcType=TIMESTAMP}, #{endDate,jdbcType=TIMESTAMP}, 
      #{updateDate,jdbcType=TIMESTAMP}, #{updateUser,jdbcType=VARCHAR}, CURRENT_TIMESTAMP, 
      #{createUser,jdbcType=VARCHAR},#{channelPerson},#{parentPath})
  </insert>
  <insert id="insertSelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into mp_agent
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null and id !=''">
        id,
      </if>
      <if test="billGroupId != null and billGroupId !=''">
        bill_group_id,
      </if>
      <if test="dataGroupId != null and dataGroupId !=''">
        data_group_id,
      </if>
      <if test="billModelId != null and billModelId !=''">
        bill_model_id,
      </if>
      <if test="dataModelId != null and dataModelId !=''">
        data_model_id,
      </if>
      <if test="userId != null and userId !=''">
        user_id,
      </if>
      <if test="name != null and name !=''">
        name,
      </if>
      <if test="nickname != null and nickname !=''">
        nickname,
      </if>
      <if test="phone != null and phone !=''">
        phone,
      </if>
      <if test="email != null and email !=''">
        email,
      </if>
      <if test="corpName != null and corpName !=''">
        corp_name,
      </if>
      <if test="address != null and address !=''">
        address,
      </if>
      <if test="hotline1 != null and hotline1 !=''">
        hotline1,
      </if>
      <if test="hotline2 != null and hotline2 !=''">
        hotline2,
      </if>
      <if test="serviceqq1 != null and serviceqq1 !=''">
        serviceqq1,
      </if>
      <if test="serviceqq2 != null and serviceqq2 !=''">
        serviceqq2,
      </if>
      <if test="appKey != null and appKey !=''">
        app_key,
      </if>
      <if test="parentId != null and parentId !=''">
        parent_id,
      </if>
      <if test="status != null and status !=''">
        status,
      </if>
      <if test="level != null">
        level,
      </if>
      <if test="startDate != null ">
        start_date,
      </if>
      <if test="endDate != null ">
        end_date,
      </if>
      <if test="updateDate != null ">
        update_date,
      </if>
      <if test="updateUser != null and updateUser !=''">
        update_user,
      </if>
        create_date,
      <if test="createUser != null and createUser !=''">
        create_user,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="billGroupId != null and billGroupId !=''">
        #{billGroupId,jdbcType=VARCHAR},
      </if>
      <if test="dataGroupId != null and dataGroupId !=''">
        #{dataGroupId,jdbcType=VARCHAR},
      </if>
      <if test="billModelId != null and billModelId !=''">
        #{billModelId,jdbcType=VARCHAR},
      </if>
      <if test="dataModelId != null and dataModelId !=''">
        #{dataModelId,jdbcType=VARCHAR},
      </if>
      <if test="userId != null and userId !=''">
        #{userId,jdbcType=VARCHAR},
      </if>
      <if test="name != null  and name !=''">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="nickname != null  and nickname !=''">
        #{nickname,jdbcType=VARCHAR},
      </if>
      <if test="phone != null  and phone !=''">
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="email != null  and email !=''">
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="corpName != null and corpName !=''">
        #{corpName,jdbcType=VARCHAR},
      </if>
      <if test="address != null and address !=''">
        #{address,jdbcType=VARCHAR},
      </if>
      <if test="hotline1 != null and hotline1 !=''">
        #{hotline1,jdbcType=VARCHAR},
      </if>
      <if test="hotline2 != null and hotline2 !=''">
        #{hotline2,jdbcType=VARCHAR},
      </if>
      <if test="serviceqq1 != null and serviceqq1 !=''">
        #{serviceqq1,jdbcType=VARCHAR},
      </if>
      <if test="serviceqq2 != null and serviceqq2 !=''">
        #{serviceqq2,jdbcType=VARCHAR},
      </if>
      <if test="appKey != null and appKey !=''">
        #{appKey,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null and parentId !=''">
        #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="status != null and status !=''">
        #{status,jdbcType=CHAR},
      </if>
      <if test="level != null">
        #{level,jdbcType=INTEGER},
      </if>
      <if test="startDate != null ">
        #{startDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null">
        #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateDate != null ">
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null and updateUser !=''">
        #{updateUser,jdbcType=VARCHAR},
      </if>
       CURRENT_TIMESTAMP,
      <if test="createUser != null and createUser !=''">
        #{createUser,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="java.util.Map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update mp_agent
    <set>
      <if test="billGroupId != null and billGroupId !=''">
        bill_group_id = #{billGroupId,jdbcType=VARCHAR},
      </if>
      <if test="dataGroupId != null and dataGroupId !=''">
        data_group_id = #{dataGroupId,jdbcType=VARCHAR},
      </if>
      <if test="billModelId != null and billModelId !=''">
        bill_model_id = #{billModelId,jdbcType=VARCHAR},
      </if>
      <if test="dataModelId != null and dataModelId !=''">
        data_model_id = #{dataModelId,jdbcType=VARCHAR},
      </if>
      <if test="userId != null and userId !=''">
        user_id = #{userId,jdbcType=VARCHAR},
      </if>
      <if test="nickname != null and nickname !=''">
        nickname = #{nickname,jdbcType=VARCHAR},
      </if>
      <if test="phone != null and phone !=''">
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="email != null and email !=''">
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="corpName != null and corpName !=''"> 
        corp_name = #{corpName,jdbcType=VARCHAR},
      </if>
      <if test="address != null and address !=''">
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="hotline1 != null and hotline1 !=''">
        hotline1 = #{hotline1,jdbcType=VARCHAR},
      </if>
      <if test="hotline2 != null and hotline2 !=''">
        hotline2 = #{hotline2,jdbcType=VARCHAR},
      </if>
      <if test="serviceqq1 != null and serviceqq1 !=''">
        serviceqq1 = #{serviceqq1,jdbcType=VARCHAR},
      </if>
      <if test="serviceqq2 != null and serviceqq2 !=''">
        serviceqq2 = #{serviceqq2,jdbcType=VARCHAR},
      </if>
      <if test="appKey != null and appKey !=''">
        app_key = #{appKey,jdbcType=VARCHAR},
      </if>
<!--       <if test="parentId != null and parentId !=''"> -->
<!--         parent_id = #{parentId,jdbcType=VARCHAR}, -->
<!--       </if> -->
      <if test="status != null and status !=''">
        status = #{status,jdbcType=CHAR},
      </if>
      <if test="level != null">
        level = #{level,jdbcType=INTEGER},
      </if>
      <if test="startDate != null">
        start_date = #{startDate,jdbcType=TIMESTAMP},
      </if>
      <if test="endDate != null">
        end_date = #{endDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateDate != null ">
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null and updateUser !=''">
        update_user = #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null ">
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createUser != null and createUser !=''">
        create_user = #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="channelPerson != null and channelPerson !=''">
        channel_person = #{channelPerson,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <select id="selectByAgentName" resultType="java.util.Map">
  	select 
  		y.*,d.`name` AS billGroupName,e.`name` AS dataGroupName,
  		f.`name` AS billDiscountModelName,g.`name` AS dataDiscountModelName 
  	from (
	    select 
	    <include refid="Base_Column_List" />
	    from 
	    	mp_agent a,sysusert b,mp_agent_account c
	    where 
	    	a.name = #{agentName,jdbcType=VARCHAR}
	    	and a.del_flag = 1
	    	and a.user_id = b.suId 
	    	and a.id = c.agent_id 
	) y left join mp_provider_bill_group d on y.bill_group_id = d.id
		left join mp_provider_data_group e on y.data_group_id = e.id
		left join mp_bill_discount_model f on y.bill_model_id = f.id
		left join mp_data_discount_model g on y.data_model_id = g.id
  </select>
  
  <select id="selectByAgentNameForOrder" resultType="java.util.Map">
    select * from mp_agent where name = #{agentName,jdbcType=VARCHAR} and del_flag = 1
  </select>
  
  <select id="selectByAgentNameAndParent" resultType="java.util.Map">
	  select * from mp_agent where name = #{agentName,jdbcType=VARCHAR} and del_flag = 1
	    <if test="agentParentId != null and agentParentId != ''" >
	      and id in(select id from mp_agent where parent_id=#{agentParentId} or id=#{agentParentId} and del_flag = 1)
	   </if>
  </select>
  
  <select id="selectByPrimaryKeyForOrder" resultType="java.util.Map">
    select * from mp_agent where id = #{id,jdbcType=VARCHAR} and del_flag = 1
  </select>
  
  <select id="selectByUserId" resultType="java.util.Map">
    select * from mp_agent where user_id = #{userId,jdbcType=VARCHAR} and del_flag = 1
  </select>
  
  <select id="selectByChannelPerson" resultType="java.util.Map">
    select * from mp_agent where channel_person = #{channelPerson,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByColumn" resultType="java.util.Map">
  	select 
  		y.*,d.`name` AS billGroupName,e.`name` AS dataGroupName,
  		f.`name` AS billDiscountModelName,g.`name` AS dataDiscountModelName 
  	from (
	    select 
	    <include refid="Base_Column_List" />
	    from 
	    	mp_agent a,sysusert b,mp_agent_account c, 
	    	mp_provider_bill_group d,mp_provider_data_group e,
	    	mp_bill_discount_model f,mp_data_discount_model g
	    where 
	    	${columnName} = '${columnValue}'
	    	and a.user_id = b.suId 
	    	and a.del_flag = 1
	    	and a.id = c.agent_id 
	) y left join mp_provider_bill_group d on y.bill_group_id = d.id
		left join mp_provider_data_group e on y.data_group_id = e.id
		left join mp_bill_discount_model f on y.bill_model_id = f.id
		left join mp_data_discount_model g on y.data_model_id = g.id
  </select>
  
  <select id="getIdByParentId" resultType="java.lang.String">
  	select id from mp_agent where parent_id=#{parentId} and del_flag = 1
  </select>
  
  <update id="updateByParentPath" parameterType="java.util.Map">
  	update mp_agent 
  	<set>
  		<if test="channelPerson != null and channelPerson !=''">
  		channel_person=#{channelPerson},
  		</if>
  		<if test="billGroupId != null and billGroupId !=''">
  		bill_group_id = #{billGroupId},
  		</if>
  		<if test="dataGroupId != null and dataGroupId !=''">
  		data_group_id = #{dataGroupId},
  		</if>
  		<if test="billModelId != null and billModelId !=''">
  		bill_model_id = #{billModelId}, 
  		</if>
  		<if test="dataModelId != null and dataModelId !=''">
  		data_model_id = #{dataModelId},
  		</if>
  	</set>
  	where parent_path like concat('%',#{parentPath,jdbcType=VARCHAR},'%') 
  </update>
  <select id="selectAgentAllParent" resultType="java.util.Map">
  		select * from mp_agent where parent_id=0
  </select>
</mapper>